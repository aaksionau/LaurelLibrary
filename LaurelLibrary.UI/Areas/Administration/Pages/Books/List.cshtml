@page "{pageNumber:int?}/{pageSize:int?}"
@model LaurelLibrary.UI.Areas.Administration.Pages.Books.ListModel

@{
    ViewData["Title"] = "Books";
}

<div class="card">
    <div class="card-header">
        <h3 class="d-inline">Books</h3>
        <div class="float-end">
            <a class="btn btn-info me-2" asp-area="Administration" asp-page="/Books/Wizard">Add Books</a>
        </div>
    </div>
    <div class="card-body">
        @if (!string.IsNullOrWhiteSpace(Model.StatusMessage))
        {
            <div class="alert alert-info">@Model.StatusMessage</div>
        }
        <div class="mb-4 p-3 border rounded bg-light">
            <form method="get" class="mb-0">
                <div class="row g-2 align-items-end">
                <div class="col">
                    <input class="form-control" type="text" name="SearchTerm" value="@Model.SearchTerm" placeholder="Search by title" />
                </div>

                <div class="col-2">
                    <select class="form-select" name="SelectedAuthorId" id="authorSelect" style="min-width: 200px;">
                        <option value="">All Authors</option>
                        @foreach (var a in Model.Authors)
                        {
                            <option value="@a.AuthorId" selected="@(Model.SelectedAuthorId == a.AuthorId ? "selected" : null)">@a.FullName</option>
                        }
                    </select>
                </div>

                <div class="col-2">
                    <select class="form-select" name="SelectedCategoryId" id="categorySelect" style="min-width: 200px;">
                        <option value="">All Categories</option>
                        @foreach (var c in Model.Categories)
                        {
                            <option value="@c.CategoryId" selected="@(Model.SelectedCategoryId == c.CategoryId ? "selected" : null)">@c.Name</option>
                        }
                    </select>
                </div>

                <input type="hidden" name="pageNumber" value="@Model.PageNumber" />
                <input type="hidden" name="pageSize" value="@Model.PageSize" />

                <div class="col-auto ms-auto">
                    <button type="submit" class="btn btn-primary me-2">Filter</button>
                    <a class="btn btn-secondary" href="@Url.Page("/Books/List", new { area = "Administration" })">Clear</a>
                </div>
            </div>
            </form>
        </div>
        @if (Model.Books.Any())
        {
            <table class="table">
                <thead>
                    <tr>
                        <th style="max-width: 70%;">Title</th>
                        <th class="text-start">Authors</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var book in Model.Books)
                {
                    <tr class="book-row" style="cursor: pointer;" onclick="window.location='@Url.Page("/Books/Details", new { area = "Administration", id = book.BookId })'">
                        <td style="max-width: 70%; word-wrap: break-word;">@book.Title</td>
                        <td class="text-start">@book.Authors</td>
                                <td class="text-end" onclick="event.stopPropagation();">
                                    <a class="btn btn-link text-primary p-0 me-2" asp-page="/Books/Update" asp-route-bookId="@book.BookId" title="Edit"><i class="bi bi-pencil"></i></a>

                                    <form method="post" asp-page-handler="Delete" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this book?');">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="bookId" value="@book.BookId" />
                                        <button type="submit" class="btn btn-link text-danger p-0" title="Delete"><i class="bi bi-trash"></i></button>
                                    </form>
                                </td>
                    </tr>
                }
            </tbody>
        </table>
        }
        else
        {
            <p class="text-center text-muted">No Books</p>
        }

        @await Component.InvokeAsync(
            typeof(LaurelLibrary.UI.ViewComponents.PaginationControlsViewComponent), 
            new { 
                model = new LaurelLibrary.UI.ViewModels.PaginationViewModel 
                { PageNumber = Model.PageNumber, 
                PageSize = Model.PageSize, 
                TotalPages = Model.TotalPages, 
                TotalCount = Model.TotalCount, 
                Area = "Administration", 
                Page = "/Books/List" } })
    </div>
</div>

@section Scripts {
    <style>
        .book-row:hover {
            background-color: #f8f9fa;
        }
    </style>
    
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <script>
        $(document).ready(function() {
            $('#authorSelect').select2({
                theme: 'bootstrap-5',
                placeholder: 'All Authors',
                allowClear: true,
                width: '100%'
            });
            
            $('#categorySelect').select2({
                theme: 'bootstrap-5',
                placeholder: 'All Categories',
                allowClear: true,
                width: '100%'
            });
        });
    </script>
}
    </div>
</div>