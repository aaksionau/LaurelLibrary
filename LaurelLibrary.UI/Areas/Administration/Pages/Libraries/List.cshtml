@page
@using Microsoft.AspNetCore.Authorization
@model LaurelLibrary.UI.Areas.Administration.Pages.Libraries.ListModel;
@{
    ViewData["Title"] = "Libraries";
}

<style>
    .library-card {
        transition: all 0.3s ease;
        cursor: pointer;
        border: 1px solid #dee2e6;
        position: relative;
    }

    .library-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(36, 92, 79, 0.15);
        border-color: var(--color-primary);
    }

    .library-stats {
        background-color: var(--color-bg-light);
        border-radius: 0.375rem;
        padding: 0.75rem;
        margin-bottom: 0.75rem;
    }

    .stat-item {
        text-align: center;
    }

    .stat-number {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--color-primary);
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--color-text-secondary);
        margin-top: 0.25rem;
    }
</style>

<div class="card">
    <div class="card-header">
        <h3 class="d-inline">Libraries</h3>
        <a class="btn btn-primary float-end d-inline" asp-area="Administration" asp-page="/Libraries/Update">Add
            Library</a>
    </div>
    <div class="card-body">
        @if (Model.Libraries.Any())
        {
            <div class="row">
                @foreach (var library in Model.Libraries)
                {
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card library-card h-100">
                            <a asp-area="Administration" asp-page="/Libraries/Details" asp-route-id="@library.LibraryId"
                                class="stretched-link text-decoration-none"></a>
                            <div class="card-header" style="background-color: var(--color-bg-light); border-bottom: 1px solid var(--color-primary-light); color: var(--color-text-primary);">
                                <h5 class="card-title mb-0">@library.Name</h5>
                                @if (!string.IsNullOrWhiteSpace(library.Alias))
                                {
                                    <small style="color: var(--color-text-secondary);">@library.Alias</small>
                                }
                            </div>
                            <div class="card-body">
                                @if (!string.IsNullOrWhiteSpace(library.Description))
                                {
                                    <p class="card-text">
                                        @(library.Description.Length > 100 ? library.Description.Substring(0, 100) + "..." : library.Description)
                                    </p>
                                }
                                
                                @if (!string.IsNullOrWhiteSpace(library.Address))
                                {
                                    <p class="card-text">
                                        <i class="bi bi-geo-alt" style="color: var(--color-secondary);"></i>
                                        <small class="text-muted">@library.Address</small>
                                    </p>
                                }

                                <div class="library-stats">
                                    <div class="row text-center">
                                        <div class="col-4 stat-item">
                                            <div class="stat-number">@library.BooksCount</div>
                                            <div class="stat-label">Books</div>
                                        </div>
                                        <div class="col-4 stat-item">
                                            <div class="stat-number">@library.StudentsCount</div>
                                            <div class="stat-label">Students</div>
                                        </div>
                                        <div class="col-4 stat-item">
                                            <div class="stat-number">@library.AdministratorsCount</div>
                                            <div class="stat-label">Admins</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between align-items-center text-muted">
                                    <small>
                                        <i class="bi bi-calendar3" style="color: var(--color-accent);"></i>
                                        Created: @library.CreatedAt.ToString("MMM dd, yyyy")
                                    </small>
                                    <a class="btn btn-outline-secondary btn-sm" asp-area="Administration" asp-page="/Libraries/Update"
                                        asp-route-libraryId="@library.LibraryId" title="Edit Library"
                                        style="position: relative; z-index: 10; border-color: var(--color-primary); color: var(--color-primary);">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <i class="bi bi-building display-1" style="color: var(--color-text-secondary);"></i>
                <h4 class="mt-3" style="color: var(--color-text-secondary);">No libraries found</h4>
                <p style="color: var(--color-text-secondary);">Get started by adding your first library.</p>
                <a class="btn" asp-area="Administration" asp-page="/Libraries/Update"
                   style="background-color: var(--color-primary); border-color: var(--color-primary); color: white;">
                    <i class="bi bi-plus-circle"></i> Add Library
                </a>
            </div>
        }
    </div>
</div>